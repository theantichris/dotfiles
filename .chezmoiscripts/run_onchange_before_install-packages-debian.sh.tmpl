{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "debian") -}}
#!/bin/bash

sudo apt update
sudo apt upgrade

sudo apt install npm

set -e

# eza
if ! command -v eza &> /dev/null; then
    sudo apt-get install -y -qq gpg
    wget -qO- https://raw.githubusercontent.com/eza-community/eza/main/gpg.key | sudo gpg --dearmor -o /usr/share/keyrings/eza-archive-keyring.gpg
    echo "deb [signed-by=/usr/share/keyrings/eza-archive-keyring.gpg] https://repo.eza.access-denied.net/eza/deb stable main" | sudo tee /etc/apt/sources.list.d/eza.list > /dev/null
    sudo apt-get update -qq
    sudo apt-get install -y -qq eza
fi

# Helix
if ! command -v helix &> /dev/null && ! command -v hx &> /dev/null; then
    HELIX_VERSION="25.07.1"
    HELIX_ARCH="aarch64"
    HELIX_URL="https://github.com/helix-editor/helix/releases/download/${HELIX_VERSION}/helix-${HELIX_VERSION}-${HELIX_ARCH}-linux.tar.xz"
    HELIX_TMP="/tmp/helix-${HELIX_VERSION}.tar.xz"

    curl -sL -o "${HELIX_TMP}" "${HELIX_URL}"
    sudo tar -xJf "${HELIX_TMP}" -C /opt
    sudo mv /opt/helix-${HELIX_VERSION}-${HELIX_ARCH}-linux /opt/helix
    sudo ln -sf /opt/helix/hx /usr/local/bin/hx
    sudo ln -sf /opt/helix/hx /usr/local/bin/helix

    mkdir -p ~/.config/helix
    if [ ! -d ~/.config/helix/runtime ]; then
        ln -s /opt/helix/runtime ~/.config/helix/runtime
    fi

    rm "${HELIX_TMP}"
fi

# Go
if ! command -v go &> /dev/null; then
    GO_VERSION="1.25.0"
    GO_ARCH="arm64"
    GO_URL="https://go.dev/dl/go${GO_VERSION}.linux-${GO_ARCH}.tar.gz"
    GO_TMP="/tmp/go${GO_VERSION}.tar.gz"
    
    curl -sL -o "${GO_TMP}" "${GO_URL}"
    sudo rm -rf /usr/local/go
    sudo tar -C /usr/local -xzf "${GO_TMP}"
    sudo ln -sf /usr/local/go/bin/go /usr/local/bin/go
    sudo ln -sf /usr/local/go/bin/gofmt /usr/local/bin/gofmt
    
    rm "${GO_TMP}"
fi

{{- end }}
